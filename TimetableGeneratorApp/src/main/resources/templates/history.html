<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>Timetable History</title>
  <style>
    body{font-family:Segoe UI,Arial; background:#0f172a; color:#fff; margin:0; padding:30px}
    .wrap{max-width:1000px; margin:0 auto; background:#f8fafc; color:#111; border-radius:12px; padding:22px; box-shadow:0 4px 16px rgba(0,0,0,.3)}
    h1{margin-top:0}
    table{width:100%; border-collapse:collapse; margin-top:10px; background:#fff}
    th,td{border:1px solid #cbd5e1; padding:8px; text-align:left; font-size:14px}
    th{background:#f1f5f9}
    a.button,button{display:inline-block; padding:6px 10px; border-radius:6px; background:#2563eb; color:#fff; text-decoration:none; border:none; cursor:pointer}
    a.button:hover,button:hover{background:#1d4ed8}
    .muted{color:#64748b}
    .row-actions{display:flex; gap:6px; flex-wrap:wrap}
    input[type="text"]{padding:6px 8px; border:1px solid #cbd5e1; border-radius:6px}
    .danger{background:#dc2626}
    .secondary{background:#475569}
  </style>
</head>
<body>
<div class="wrap">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
    <h1>Timetable History</h1>
    <a href="/" class="button secondary">‚Üê Back</a>
  </div>

  <table>
    <thead>
    <tr>
      <th style="width:90px">Version</th>
      <th style="width:260px">Name</th>
      <th>Run ID</th>
      <th style="width:170px">Generated At</th>
      <th style="width:80px">Rows</th>
      <th style="width:330px">Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="r : ${runs}">
      <td th:text="${r.version}"></td>
      <td>
        <form th:action="@{/history/rename}" method="post" style="display:flex; gap:6px; align-items:center">
          <input type="hidden" name="runId" th:value="${r.runId}" />
          <input type="text" name="runName" th:value="${r.runName}" placeholder="(unnamed run)" />
          <button type="submit" class="button">Rename</button>
        </form>
      </td>
      <td><span class="muted" th:text="${r.runId}"></span></td>
      <td th:text="${#dates.format(r.generatedAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
      <td th:text="${r.rowsCount}"></td>
      <td>
        <div class="row-actions">
          <a class="button" th:href="@{'/history/view'(runId=${r.runId})}">Open</a>
          <a class="button" th:href="@{'/export/history/csv'(runId=${r.runId})}">CSV</a>
          <a class="button" th:href="@{'/export/history/excel'(runId=${r.runId})}">Excel</a>
          <form th:action="@{/history/delete}" method="post" onsubmit="return confirm('Delete this timetable run permanently?')">
            <input type="hidden" name="runId" th:value="${r.runId}" />
            <button type="submit" class="button danger">Delete</button>
          </form>
        </div>
      </td>
    </tr>
    </tbody>
  </table>
</div>
</body>
</html>
